# PR Review Service

Сервис назначения ревьюеров для Pull Request'ов.

## Описание

Микросервис для автоматического назначения ревьюеров на Pull Request'ы, управления командами и участниками. Взаимодействие происходит через HTTP API.

## Технологии

- Go (стандартная библиотека для HTTP)
- PostgreSQL
- `github.com/lib/pq` для работы с PostgreSQL

## Запуск

Сервис и все зависимости поднимаются одной командой:

```bash
docker-compose up
```

Сервис будет доступен на порту 8080.

## Веб-интерфейс для тестирования

После запуска сервиса доступен простой веб-интерфейс для тестирования всех API endpoints:

Откройте в браузере: http://localhost:8080/

Интерфейс позволяет:
- Создавать команды и управлять пользователями
- Создавать Pull Request'ы и проверять автоматическое назначение ревьюверов
- Выполнять merge и переназначение ревьюверов
- Просматривать PR'ы, назначенные пользователю

## API Endpoints

Все endpoints соответствуют спецификации OpenAPI из файла `openapi.yml`:

- `POST /team/add` - Создать команду с участниками
- `GET /team/get?team_name=<name>` - Получить команду с участниками
- `POST /team/bulkDeactivate` - Массовая деактивация пользователей команды с безопасным переназначением ревьюверов в открытых PR
- `POST /users/setIsActive` - Установить флаг активности пользователя
- `GET /users/getReview?user_id=<id>` - Получить PR'ы, где пользователь назначен ревьювером
- `POST /pullRequest/create` - Создать PR и автоматически назначить до 2 ревьюверов
- `POST /pullRequest/merge` - Пометить PR как MERGED (идемпотентная операция)
- `POST /pullRequest/reassign` - Переназначить конкретного ревьювера
- `GET /stats` - Получить статистику (количество назначений по пользователям и PR)
- `GET /health` - Health check endpoint

## Нагрузочное тестирование

Проведено нагрузочное тестирование решения.

**Результаты:**
- Система справляется с целевым RPS = 5
- Все endpoints укладываются в SLI времени ответа 300 мс
- Успешность запросов превышает 99.9%

Для запуска нагрузочного тестирования:
```bash
# Убедитесь, что сервис запущен на localhost:8080
go run ./tools/loadtest
```

Или укажите другой URL:
```bash
go run ./tools/loadtest http://localhost:8080
```

## Линтер

Проект использует `golangci-lint` для проверки качества кода. Конфигурация находится в файле `.golangci.yml`.


```bash
# Проверить весь проект
golangci-lint run

# Проверить конкретную директорию
golangci-lint run ./internal/...

# Автоматически исправить проблемы
golangci-lint run --fix
```

### Включенные проверки

Линтер настроен на проверку:
- **Ошибки**: errcheck, govet, typecheck
- **Стиль кода**: gofmt, goimports, golint, misspell, whitespace
- **Производительность**: gocritic, unconvert, unparam
- **Безопасность**: gosec
- **Сложность**: gocyclo (максимум 15)
- **Длина строк**: lll (максимум 120 символов)


## Makefile

Проект включает Makefile для удобной работы с проектом:

```bash
make build          # Собрать приложение
make run            # Запустить приложение локально
make test           # Запустить тесты
make lint           # Запустить линтер
make lint-fix       # Запустить линтер с автоисправлением
make clean          # Очистить артефакты сборки
make docker-build   # Собрать Docker образ
make docker-up      # Запустить через Docker Compose
make docker-down    # Остановить сервисы
make loadtest       # Запустить нагрузочное тестирование
make check          # Полная проверка (lint + test)
```